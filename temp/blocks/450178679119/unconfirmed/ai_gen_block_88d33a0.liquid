{% doc %}
  @prompt
    Create a full-width, four-column product grid section.
    
    The columns should be equally sized with a small gutter for white space between them and have a full-bleed image, with the option to customise the image aspect ratio. The text for the product name and price should be fully customisable. Font, size, left placement, right placement, centred., i need the option to display a collection. I also need the option to choose how many products I'd like to showcase on one page, and on mobile/tablet, on portrait for the image aspect ratio, some of the images are cropped. Can we include a feature that will fit the image into the portrait container?, can we lastly add the option to customise the font and price size too for the mobile version, can we make poppins the default font.
    
    also make the mobile font size able to go below 10 please. Possibly starting from 2 in intervals of 2

{% enddoc %}
{% assign ai_gen_id = block.id | replace: '_', '' | downcase %}

{% style %}
  .ai-product-grid-{{ ai_gen_id }} {
    width: 100%;
    padding: 0;
    margin: 0;
  }

  .ai-product-grid__container-{{ ai_gen_id }} {
    display: grid;
    grid-template-columns: repeat({{ block.settings.columns_desktop }}, 1fr);
    gap: {{ block.settings.grid_gap }}px;
    width: 100%;
  }

  .ai-product-grid__item-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    width: 100%;
  }

  .ai-product-grid__image-container-{{ ai_gen_id }} {
    position: relative;
    width: 100%;
    aspect-ratio: {{ block.settings.image_aspect_ratio }};
    overflow: hidden;
    margin-bottom: {{ block.settings.text_spacing }}px;
    {% if block.settings.image_fit == 'contain' %}
      background-color: {{ block.settings.image_background_color }};
    {% endif %}
  }

  .ai-product-grid__image-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    object-fit: {{ block.settings.image_fit }};
    display: block;
  }

  .ai-product-grid__image-placeholder-{{ ai_gen_id }} {
    width: 100%;
    height: 100%;
    background-color: #f4f4f4;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .ai-product-grid__image-placeholder-{{ ai_gen_id }} svg {
    width: 100%;
    height: 100%;
    max-width: 200px;
    max-height: 200px;
    opacity: 0.3;
  }

  .ai-product-grid__content-{{ ai_gen_id }} {
    display: flex;
    flex-direction: column;
    gap: {{ block.settings.content_gap }}px;
    text-align: {{ block.settings.text_alignment }};
  }

  .ai-product-grid__title-{{ ai_gen_id }} {
    font-family: {{ block.settings.title_font.family }}, {{ block.settings.title_font.fallback_families }};
    font-weight: {{ block.settings.title_font.weight }};
    font-style: {{ block.settings.title_font.style }};
    font-size: {{ block.settings.title_font_size }}px;
    color: {{ block.settings.title_color }};
    margin: 0;
    line-height: 1.3;
  }

  .ai-product-grid__price-{{ ai_gen_id }} {
    font-family: {{ block.settings.price_font.family }}, {{ block.settings.price_font.fallback_families }};
    font-weight: {{ block.settings.price_font.weight }};
    font-style: {{ block.settings.price_font.style }};
    font-size: {{ block.settings.price_font_size }}px;
    color: {{ block.settings.price_color }};
    margin: 0;
  }

  .ai-product-grid__link-{{ ai_gen_id }} {
    text-decoration: none;
    color: inherit;
    display: block;}

  .ai-product-grid__link-{{ ai_gen_id }}:hover .ai-product-grid__title-{{ ai_gen_id }} {
    color: {{ block.settings.title_hover_color }};
  }

  .ai-product-grid__empty-state-{{ ai_gen_id }} {
    grid-column: 1 / -1;
    text-align: center;
    padding: 60px 20px;
    color: #666;
    font-size: 16px;
  }

  @media screen and (max-width: 990px) {
    .ai-product-grid__container-{{ ai_gen_id }} {
      grid-template-columns: repeat({{ block.settings.columns_tablet }}, 1fr);
    }
  }

  @media screen and (max-width: 749px) {
    .ai-product-grid__container-{{ ai_gen_id }} {
      grid-template-columns: repeat({{ block.settings.columns_mobile }}, 1fr);
    }

    .ai-product-grid__title-{{ ai_gen_id }} {
      font-size: {{ block.settings.title_font_size_mobile }}px;
    }

    .ai-product-grid__price-{{ ai_gen_id }} {
      font-size: {{ block.settings.price_font_size_mobile }}px;
    }
  }
{% endstyle %}

<div class="ai-product-grid-{{ ai_gen_id }}" {{ block.shopify_attributes }}>
  <div class="ai-product-grid__container-{{ ai_gen_id }}">
    {% liquid
      if block.settings.collection != blank
        assign products_to_show = block.settings.collection.products | limit: block.settings.products_to_show
      else
        assign products_to_show = collections.all.products | limit: block.settings.products_to_show
      endif
    %}

    {% if products_to_show.size > 0 %}
      {% for product in products_to_show %}
        <div class="ai-product-grid__item-{{ ai_gen_id }}"><a href="{{ product.url }}" class="ai-product-grid__link-{{ ai_gen_id }}">
            <div class="ai-product-grid__image-container-{{ ai_gen_id }}">
              {% if product.featured_image %}
                <img
                  src="{{ product.featured_image | image_url: width: 800 }}"
                  alt="{{ product.featured_image.alt | escape }}"
                  class="ai-product-grid__image-{{ ai_gen_id }}"
                  loading="lazy"
                  width="{{ product.featured_image.width }}"
                  height="{{ product.featured_image.height }}"
                >
              {% else %}
                <div class="ai-product-grid__image-placeholder-{{ ai_gen_id }}">
                  {{ 'product-apparel-1' | placeholder_svg_tag }}
                </div>
              {% endif %}
            </div>
            <div class="ai-product-grid__content-{{ ai_gen_id }}">
              <h3 class="ai-product-grid__title-{{ ai_gen_id }}">{{ product.title }}</h3>
              <div class="ai-product-grid__price-{{ ai_gen_id }}">{{ product.price | money }}</div></div>
          </a>
        </div>
      {% endfor %}
    {% else %}
      <div class="ai-product-grid__empty-state-{{ ai_gen_id }}">
        {% if block.settings.collection == blank %}
          Select a collection to display products
        {% else %}
          No products found in this collection
        {% endif %}
      </div>
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "Product grid",
  "settings": [
    {
      "type": "header",
      "content": "Collection"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 1,
      "max": 50,
      "step": 1,
      "label": "Products to show",
      "default": 8
    },
    {
      "type": "header",
      "content": "Layout"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 1,
      "max": 6,
      "step": 1,
      "label": "Columns on desktop",
      "default": 4
    },
    {
      "type": "range",
      "id": "columns_tablet",
      "min": 1,
      "max": 4,
      "step": 1,
      "label": "Columns on tablet",
      "default": 2
    },
    {
      "type": "range",
      "id": "columns_mobile",
      "min": 1,
      "max": 3,
      "step": 1,
      "label": "Columns on mobile",
      "default": 1
    },
    {
      "type": "range",
      "id": "grid_gap",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "label": "Grid gap",
      "default": 16
    },
    {
      "type": "header",
      "content": "Image"
    },
    {
      "type": "select",
      "id": "image_aspect_ratio",
      "label": "Image aspect ratio",
      "options": [
        {"value": "1/1", "label": "Square (1:1)"},
        {"value": "3/4", "label": "Portrait (3:4)"},
        {"value": "4/3", "label": "Landscape (4:3)"},
        {"value": "16/9", "label": "Widescreen (16:9)"}
      ],
      "default": "1/1"
    },
    {
      "type": "select",
      "id": "image_fit",
      "label": "Image fit",
      "options": [
        {"value": "cover", "label": "Fill container (may crop)"},
        {"value": "contain", "label": "Fit entire image (may show background)"}
      ],
      "default": "cover"
    },
    {
      "type": "color",
      "id": "image_background_color",
      "label": "Image background color",
      "default": "#ffffff",
      "info": "Visible when 'Fit entire image' is selected"
    },
    {
      "type": "range",
      "id": "text_spacing",
      "min": 0,
      "max": 40,
      "step": 4,
      "unit": "px",
      "label": "Space below image",
      "default": 12
    },
    {
      "type": "header",
      "content": "Text layout"
    },
    {
      "type": "select",
      "id": "text_alignment",
      "label": "Text alignment",
      "options": [
        {"value": "left", "label": "Left"},
        {"value": "center", "label": "Center"},
        {"value": "right", "label": "Right"}
      ],
      "default": "left"
    },
    {
      "type": "range",
      "id": "content_gap",
      "min": 0,
      "max": 20,
      "step": 2,
      "unit": "px",
      "label": "Space between title and price",
      "default": 4
    },
    {
      "type": "header",
      "content": "Product title"
    },
    {
      "type": "font_picker",
      "id": "title_font",
      "label": "Title font",
      "default": "poppins_n4"
    },
    {
      "type": "range",
      "id": "title_font_size",
      "min": 12,
      "max": 32,
      "step": 1,
      "unit": "px",
      "label": "Title font size",
      "default": 16
    },
    {
      "type": "range",
      "id": "title_font_size_mobile",
      "min": 2,
      "max": 28,
      "step": 2,
      "unit": "px",
      "label": "Title font size on mobile",
      "default": 14
    },
    {
      "type": "color",
      "id": "title_color",
      "label": "Title color",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "title_hover_color",
      "label": "Title hover color",
      "default": "#666666"
    },
    {
      "type": "header",
      "content": "Product price"
    },
    {
      "type": "font_picker",
      "id": "price_font",
      "label": "Price font",
      "default": "poppins_n4"
    },
    {
      "type": "range",
      "id": "price_font_size",
      "min": 12,
      "max": 28,
      "step": 1,
      "unit": "px",
      "label": "Price font size",
      "default": 14
    },
    {
      "type": "range",
      "id": "price_font_size_mobile",
      "min": 2,
      "max": 24,
      "step": 2,
      "unit": "px",
      "label": "Price font size on mobile",
      "default": 12
    },
    {
      "type": "color",
      "id": "price_color",
      "label": "Price color",
      "default": "#666666"
    }
  ],
  "presets": [
    {
      "name": "Product grid"
    }
  ],
  "tag": null
}
{% endschema %}